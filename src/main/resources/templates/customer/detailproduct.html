<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{customer/layout/head_customer}"></head>
<style>
		.notification {
			display:none;
		    position: fixed;
		    top: 20px; /* khoảng cách từ trên */
		    right: 20px; /* khoảng cách từ bên phải */
		    background-color: #FFD333; /* màu nền */
		    color: black; /* màu chữ */
		    padding: 15px; /* khoảng cách bên trong */
		    border-radius: 5px; /* bo góc */
		    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); /* đổ bóng */
		    transform: translateX(100%); 
		    opacity: 0;
		    z-index: 1000;
		    animation : slideleft 4s;
		}
		@keyframes slideleft{
			0%{
			transform: translateX(100%); 
			opacity: 0;
			}
			50%{
			transform: translateX(0); 
			opacity: 1;
			}
			100%{
			transform: translateX(100%); 
			opacity: 0;
			}
		}
		.comment-input.banned {
    color: red !important; /* Dùng !important để override các style khác */
}
/* Container chính */
.product-reviews {
    padding: 20px;
    background: #fff;
}

/* Form comment chính */
.main-comment-form {
    position: sticky;
    top: 0;
    background: #fff;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
    z-index: 10;
}

/* Style chung cho input groups */
.comment-input-group, .reply-input-group {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

/* Style chung cho inputs */
.comment-input, .reply-input {
    flex: 1;
    padding: 8px 15px;
    border: 1px solid #ddd;
    border-radius: 20px;
    outline: none;
    transition: border-color 0.2s;
}

.comment-input:focus, .reply-input:focus {
    border-color: #007bff;
}

/* Style cho nút submit */
.comment-submit, .reply-submit {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.comment-submit:hover, .reply-submit:hover {
    background: #0056b3;
}

/* Container comments có scroll */
.comments-container {
	min-height:200px;
    max-height: 350px;
    overflow-y: auto;
    margin-top: 15px;
    padding-right: 10px;
}

/* Tùy chỉnh thanh scroll */
.comments-container::-webkit-scrollbar {
    width: 6px;
}

.comments-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.comments-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

.comments-container::-webkit-scrollbar-thumb:hover {
    background: #666;
}

/* Comment items */
.comment-item {
    margin-bottom: 20px;
}

.comment-main {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* Comment header */
.comment-header, .reply-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-info i {
    color: #666;
    font-size: 1.2em;
}

.username {
    font-weight: 500;
    color: #333;
}

.staff-name {
    color: #007bff;
}

.comment-date, .reply-date {
    font-size: 0.85em;
    color: #666;
}

/* Comment content */
.comment-content, .reply-content {
    color: #444;
    line-height: 1.5;
    margin: 10px 0;
}

/* Comment actions */
.comment-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #eee;
}

.action-btn {
    background: none;
    border: 1px solid #ddd;
    padding: 5px 12px;
    border-radius: 15px;
    cursor: pointer;
    color: #666;
    font-size: 0.9em;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.2s;
}

.action-btn:hover {
    background: #f0f0f0;
    color: #333;
}

/* Replies section */
.replies-section {
    margin-left: 30px;
    margin-top: 10px;
    padding-left: 15px;
    border-left: 2px solid #e9ecef;
}

.reply-item {
    background: #fff;
    margin: 10px 0;
    padding: 12px;
    border-radius: 6px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Reply input group */
.reply-input-group {
    margin-top: 10px;
    padding: 10px;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
/* Login prompt */
.login-prompt {
    text-align: center;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
    color: #666;
}

.login-prompt a {
    color: #007bff;
    text-decoration: none;
}

.login-prompt a:hover {
    text-decoration: underline;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .replies-section {
        margin-left: 15px;
        padding-left: 10px;
    }
    
    .comment-input, .reply-input {
        padding: 6px 12px;
    }
    
    .comment-submit, .reply-submit {
        width: 32px;
        height: 32px;
    }
}
.main-image-container {
    width: 100%;
    height: 400px; /* Set a fixed height */
    overflow: hidden;
    margin-bottom: 20px;
}

.thumbnail-container {
    display: flex;
    gap: 10px;
    overflow-x: auto; /* Allow horizontal scrolling */
    padding: 10px 0;
}

.thumbnail img {
    width: 100px;
    height: 100px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
}

.thumbnail img:hover {
    border-color: #007bff; /* Highlight on hover */
}
</style>
<body>

	<div th:replace="~{customer/layout/header_customer}"></div>

	<!-- Breadcrumb Start -->

	<div class="container-fluid">
		<div class="row px-xl-5">
			<div class="col-12">
				<nav class="breadcrumb bg-light mb-30">
					<a class="breadcrumb-item text-dark" href="/">Home</a> <a
						class="breadcrumb-item text-dark" href="/shoppingpage/reset">Shop</a>
					<span class="breadcrumb-item active">Shop Detail</span>
				</nav>
			</div>
		</div>
	</div>
	<!-- Breadcrumb End -->


	<!-- Shop Detail Start -->
	<div class="container-fluid pb-5">
		<div class="row px-xl-5">
			<div class="col-lg-5 mb-30">
				<div class="main-image-container">
    <!-- Main product image -->
    <img id="mainProductImage" class="w-100 h-100" th:if="${product != null}"
         th:src="'/uploads/'+${product.Img}" alt="Main Product Image">
</div>

<!-- Thumbnails -->
<div class="thumbnail-container">
    <div th:each="image : ${productImages}" class="thumbnail">
        <img th:src="@{'/uploads/' + ${image.img_url}}" alt="Product Thumbnail"
             onclick="updateMainImage(this.src)">
    </div>
</div>
			</div>

			<div class="col-lg-7 h-auto mb-30">
				<div class="h-100 bg-light p-30">
					<h3 th:text="${product.Product_name}"></h3>
					<div class="d-flex mb-3">
						<div class="text-primary mr-2">
							<th:block th:with="rating=${product.averageRating}">
								<th:block th:if="${rating >= 1}">
									<small class="fas fa-star"></small>
								</th:block>
								<th:block th:if="${rating >= 0.5 && rating < 1}">
									<small class="fas fa-star-half-alt"></small>
								</th:block>
								<th:block th:if="${rating < 0.5}">
									<small class="far fa-star"></small>
								</th:block>

								<th:block th:if="${rating >= 2}">
									<small class="fas fa-star"></small>
								</th:block>
								<th:block th:if="${rating >= 1.5 && rating < 2}">
									<small class="fas fa-star-half-alt"></small>
								</th:block>
								<th:block th:if="${rating < 1.5}">
									<small class="far fa-star"></small>
								</th:block>

								<th:block th:if="${rating >= 3}">
									<small class="fas fa-star"></small>
								</th:block>
								<th:block th:if="${rating >= 2.5 && rating < 3}">
									<small class="fas fa-star-half-alt"></small>
								</th:block>
								<th:block th:if="${rating < 2.5}">
									<small class="far fa-star"></small>
								</th:block>

								<th:block th:if="${rating >= 4}">
									<small class="fas fa-star"></small>
								</th:block>
								<th:block th:if="${rating >= 3.5 && rating < 4}">
									<small class="fas fa-star-half-alt"></small>
								</th:block>
								<th:block th:if="${rating < 3.5}">
									<small class="far fa-star"></small>
								</th:block>

								<th:block th:if="${rating >= 5}">
									<small class="fas fa-star"></small>
								</th:block>
								<th:block th:if="${rating >= 4.5 && rating < 5}">
									<small class="fas fa-star-half-alt"></small>
								</th:block>
								<th:block th:if="${rating < 4.5}">
									<small class="far fa-star"></small>
								</th:block>
							</th:block>
						</div>
						<small class="pt-1"> (<span
							th:text="${product.totalFeedbacks}">0</span> Reviews)
						</small>
					</div>
					<h3 class="font-weight-semi-bold mb-4"
						th:text="'$' + ${product.Price}"></h3>
					<div style="min-height: 50px; max-height: 160px; overflow: auto;">
						<p th:each="item : ${list_spe}" style="margin-bottom: 10px;">
							<span th:text="${item.Name_spe}"></span> : <span
								th:text=" ${item.Des_spe}"></span>
						</p>
					</div>

					<!--  <div class="d-flex mb-3">
                        <strong class="text-dark mr-3">Sizes:</strong>
                    </div> -->
					<!-- <div class="d-flex mb-4">
                        <strong class="text-dark mr-3">Colors:</strong>
                        <form>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="color-1" name="color">
                                <label class="custom-control-label" for="color-1">Black</label>
                            </div>
                           
                        </form>
                    </div> -->
					<div class="d-flex align-items-center mb-4 pt-2">
						<div class="input-group" style="width: 100px;">
							<div class="input-group-btn">
								<div th:onclick="minusFromCart()" class="btn-sm btn-primary">
									<i class="fa fa-minus"></i>
								</div>
							</div>
							<input type="text"
								class="form-control form-control-sm bg-secondary border-0 text-center"
								id="quantitytocart" value="1" readonly />
							<div class="input-group-btn">
								<div th:onclick="updateQuantity()" class="btn-sm btn-primary">
									<i class="fa fa-plus"></i>
								</div>
							</div>
						</div>

					</div>
					<div class="d-flex align-items-center mb-4 pt-2">
						<button th:if="${product.status != 'OutOfStock'}"
							th:onclick="'addtocarttttt(' + ${product.Id} + ')'"
							class="btn btn-primary px-3">
							<i class="fa fa-shopping-cart mr-1"></i> Add To Cart
						</button>
						<button th:if="${product.status == 'OutOfStock'}"
							style="background-color: #fcf0be; border-color: #545b62; color: black;"
							class="btn px-3">Out of stock</button>
					</div>
				</div>
			</div>
		</div>
		<div class="row px-xl-5">
			<div class="col">
				<div class="bg-light p-30">
					<div class="nav nav-tabs mb-4">
						<a class="nav-item nav-link text-dark active" data-toggle="tab"
							href="#tab-pane-1">Description</a>
						<!-- <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Information</a> -->
						<a class="nav-item nav-link text-dark" data-toggle="tab"
							href="#tab-pane-2">Reviews</a> <a
							class="nav-item nav-link text-dark" data-toggle="tab"
							href="#tab-pane-3">Comment</a>
					</div>
					<div class="tab-content">
						<div class="tab-pane fade show active" id="tab-pane-1">
							<h4 class="mb-3">Product Description</h4>
							<p th:text="${product.Description}"></p>
						</div>
						<div class="tab-pane fade" id="tab-pane-2">
							<h4 class="mb-3">Customer Reviews</h4>
							<div class="row">
								<div class="col-3">
									<div class="d-flex mb-3">
										<div class="text-primary mr-2">
											<th:block th:with="rating=${product.averageRating}">
												<!-- Rating từ 1-5 -->
												<th:block th:if="${rating >= 1}">
													<small class="fas fa-star"></small>
												</th:block>
												<th:block th:if="${rating >= 0.5 && rating < 1}">
													<small class="fas fa-star-half-alt"></small>
												</th:block>
												<th:block th:if="${rating < 0.5}">
													<small class="far fa-star"></small>
												</th:block>

												<th:block th:if="${rating >= 2}">
													<small class="fas fa-star"></small>
												</th:block>
												<th:block th:if="${rating >= 1.5 && rating < 2}">
													<small class="fas fa-star-half-alt"></small>
												</th:block>
												<th:block th:if="${rating < 1.5}">
													<small class="far fa-star"></small>
												</th:block>

												<th:block th:if="${rating >= 3}">
													<small class="fas fa-star"></small>
												</th:block>
												<th:block th:if="${rating >= 2.5 && rating < 3}">
													<small class="fas fa-star-half-alt"></small>
												</th:block>
												<th:block th:if="${rating < 2.5}">
													<small class="far fa-star"></small>
												</th:block>

												<th:block th:if="${rating >= 4}">
													<small class="fas fa-star"></small>
												</th:block>
												<th:block th:if="${rating >= 3.5 && rating < 4}">
													<small class="fas fa-star-half-alt"></small>
												</th:block>
												<th:block th:if="${rating < 3.5}">
													<small class="far fa-star"></small>
												</th:block>

												<th:block th:if="${rating >= 5}">
													<small class="fas fa-star"></small>
												</th:block>
												<th:block th:if="${rating >= 4.5 && rating < 5}">
													<small class="fas fa-star-half-alt"></small>
												</th:block>
												<th:block th:if="${rating < 4.5}">
													<small class="far fa-star"></small>
												</th:block>
											</th:block>
										</div>
										<small class="pt-1"> (<span
											th:text="${product.totalFeedbacks}"></span> Reviews)
										</small>
									</div>
								</div>
							</div>


							<h5>Feedbacks comment</h5>
							<div class="feedback-scroll"
								style="max-height: 300px; overflow-y: auto;">
								<div th:if="${not #lists.isEmpty(product.feedbacks)}"
									class="row">
									<div class="col-md-12">
										<div class="list-group">
											<div th:each="feedback : ${product.feedbacks}"
												class="list-group-item mb-3">
												<div
													class="d-flex justify-content-between align-items-center">
													<h6 class="mb-1" th:text="${feedback.customerName}"></h6>
													<small
														th:text="${#temporals.format(feedback.created_Date, 'dd-MM-yyyy')}">Date</small>
												</div>

												<!-- Rating stars -->
												<div class="text-primary mb-2">
													<th:block th:with="rate=${feedback.rating}">
														<!-- Rating từ 1-5 -->
														<th:block th:if="${rate >= 1}">
															<small class="fas fa-star"></small>
														</th:block>
														<th:block th:if="${rate < 1}">
															<small class="far fa-star"></small>
														</th:block>

														<th:block th:if="${rate >= 2}">
															<small class="fas fa-star"></small>
														</th:block>
														<th:block th:if="${rate < 2}">
															<small class="far fa-star"></small>
														</th:block>

														<th:block th:if="${rate >= 3}">
															<small class="fas fa-star"></small>
														</th:block>
														<th:block th:if="${rate < 3}">
															<small class="far fa-star"></small>
														</th:block>

														<th:block th:if="${rate >= 4}">
															<small class="fas fa-star"></small>
														</th:block>
														<th:block th:if="${rate < 4}">
															<small class="far fa-star"></small>
														</th:block>

														<th:block th:if="${rate >= 5}">
															<small class="fas fa-star"></small>
														</th:block>
														<th:block th:if="${rate < 5}">
															<small class="far fa-star"></small>
														</th:block>
													</th:block>
												</div>

												<p class="mb-1" th:text="${feedback.comment}">Comment</p>
											</div>
										</div>
									</div>
								</div>

								<div
									th:if="${#lists.isEmpty(product.feedbacks.?[comment != null && !comment.isEmpty()])}"
									class="text-center py-4">
									<p class="text-muted">No reviews yet. Be the first to
										review this product!</p>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="tab-pane-3">
							<div class="product-reviews">
								<!-- Notification container -->
								<div id="notification-container"></div>

								<!-- Form comment chính -->
								<div class="main-comment-form">
									<h5>Write a Comment</h5>
									<div class="comment-input-group">
										<input type="text" class="comment-input"
											placeholder="Write your comment here...">
										<button class="comment-submit"
											th:onclick="submitComment(this, [[${product.Id}]])">
											<i class="fas fa-paper-plane"></i>
										</button>
									</div>
								</div>

								<!-- Số lượng reviews -->
								<div class="reviews-count">
									<h5>
										Customer Comments (<span th:text="${comments.size()}">0</span>)
									</h5>
								</div>

								<!-- Container comments -->
								<div class="comments-container">
									<!-- Comment chính -->
									<div th:each="comment : ${comments}" class="comment-item">
										<div class="comment-main">
											<div class="comment-header">
												<div class="user-info">
													<i class="fas fa-user-circle"></i> <span class="username"
														th:text="${comment.customerFirstName + ' ' + comment.customerLastName}"></span>
												</div>
												<span class="comment-date"
													th:text="${#temporals.format(comment.createdAt, 'dd-MM-yyyy HH:mm')}"></span>
											</div>

											<div class="comment-content" th:text="${comment.content}"></div>

											<div class="comment-actions">
												<button class="action-btn reply-btn"
													th:onclick="'showReplyInput(' + ${comment.id} + ')'">
													<i class="fas fa-reply"></i> Reply
												</button>
												<button class="action-btn toggle-replies-btn"
													th:if="${not #lists.isEmpty(comment.replies)}"
													th:onclick="'toggleReplies(' + ${comment.id} + ')'">
													<i class="fas fa-chevron-down"></i> <span
														th:text="${comment.replies.size() + ' replies'}"></span>
												</button>
											</div>

											<!-- Reply input ngay dưới comment chính -->
											<div class="reply-input-group"
												th:id="'reply-input-' + ${comment.id}"
												style="display: none;">
												<input type="text" class="reply-input"
													placeholder="Write your reply...">
												<button class="reply-submit"
													th:onclick="submitReply([[${comment.id}]], this, [[${product.Id}]])">
													<i class="fas fa-paper-plane"></i>
												</button>
											</div>
										</div>

										<!-- Replies section -->
										<div th:id="'replies-' + ${comment.id}"
											class="replies-section" style="display: none;">
											<div th:each="reply : ${comment.replies}" class="reply-item">
												<div class="reply-header">
													<div class="user-info">
														<i th:if="${reply.employeeId != 0}"
															class="fas fa-user-tie text-primary"></i> <i
															th:if="${reply.employeeId == 0}"
															class="fas fa-user-circle"></i> <span class="username"
															th:classappend="${reply.employeeId != 0} ? 'staff-name'">
															<span th:if="${reply.employeeId != 0}"
															class="staff-label">Staff: </span> <span
															th:text="${reply.employeeId != 0 ? reply.employeeFirstName + ' ' + reply.employeeLastName : reply.customerFirstName + ' ' + reply.customerLastName}"></span>
														</span>
													</div>
													<span class="reply-date"
														th:text="${#temporals.format(reply.createdAt, 'dd-MM-yyyy HH:mm')}"></span>
												</div>
												<div class="reply-content" th:text="${reply.content}"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Shop Detail End -->


	<!-- Products Start -->
	<div class="container-fluid py-5">
		<h2
			class="section-title position-relative text-uppercase mx-xl-5 mb-4">
			<span class="bg-secondary pr-3">Products of the same category</span>
		</h2>
		<div class="row px-xl-5">
			<div class="col">
				<div class="owl-carousel related-carousel">
					<div class="product-item bg-light" th:each="item : ${list_procate}">
						<div class="product-img position-relative overflow-hidden">
							<img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}"
								alt="">
							<div class="product-action">
								<a class="btn btn-outline-dark btn-square"
									th:if="${item.status != 'OutOfStock'}"
									th:onclick="'addToCart(' + ${item.Id} + ')'"> <i
									class="fa fa-shopping-cart"></i>
								</a> <span th:if="${item.Status == 'OutOfStock'}"
									class="out-of-stock-message">Out of stock</span>
							</div>
						</div>
						<div class="text-center py-4">
							<a class="h6 text-decoration-none text-truncate"
								th:href="@{'/detailproduct/product?id=' + ${item.Id}}"
								th:text="${item.Product_name}"></a>
							<div
								class="d-flex align-items-center justify-content-center mt-2">
								<h5 th:text="'$' + ${item.Price}"></h5>
							</div>
							<div
								class="d-flex align-items-center justify-content-center mb-1">
								<div class="text-primary mr-2">
									<th:block th:with="rating=${item.averageRating}">
										<!-- Rating từ 1-5 -->
										<th:block th:if="${rating >= 1}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 0.5 && rating < 1}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 0.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 2}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 1.5 && rating < 2}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 1.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 3}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 2.5 && rating < 3}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 2.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 4}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 3.5 && rating < 4}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 3.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 5}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 4.5 && rating < 5}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 4.5}">
											<small class="far fa-star"></small>
										</th:block>
									</th:block>
								</div>
								<small class="pt-1"> (<span
									th:text="${item.totalFeedbacks}">0</span>)
								</small>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Products End -->

	<div class="container-fluid py-5">
		<h2
			class="section-title position-relative text-uppercase mx-xl-5 mb-4">
			<span class="bg-secondary pr-3">Products of the same brand</span>
		</h2>
		<div class="row px-xl-5">
			<div class="col">
				<div class="owl-carousel related-carousel">
					<div class="product-item bg-light"
						th:each="item : ${list_probrands}">
						<div class="product-img position-relative overflow-hidden">
							<img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}"
								alt="">
							<div class="product-action">
								<a class="btn btn-outline-dark btn-square"
									th:if="${item.status != 'OutOfStock'}"
									th:onclick="'addToCart(' + ${item.Id} + ')'"> <i
									class="fa fa-shopping-cart"></i>
								</a> <span th:if="${item.Status == 'OutOfStock'}"
									class="out-of-stock-message">Out of stock</span>
							</div>
						</div>
						<div class="text-center py-4">
							<a class="h6 text-decoration-none text-truncate"
								th:href="@{'/detailproduct/product?id=' + ${item.Id}}"
								th:text="${item.Product_name}"></a>
							<div
								class="d-flex align-items-center justify-content-center mt-2">
								<h5 th:text="'$' + ${item.Price}"></h5>
							</div>
							<div
								class="d-flex align-items-center justify-content-center mb-1">
								<div class="text-primary mr-2">
									<th:block th:with="rating=${item.averageRating}">
										<!-- Rating từ 1-5 -->
										<th:block th:if="${rating >= 1}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 0.5 && rating < 1}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 0.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 2}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 1.5 && rating < 2}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 1.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 3}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 2.5 && rating < 3}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 2.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 4}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 3.5 && rating < 4}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 3.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 5}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 4.5 && rating < 5}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 4.5}">
											<small class="far fa-star"></small>
										</th:block>
									</th:block>
								</div>
								<small class="pt-1"> (<span
									th:text="${item.totalFeedbacks}">0</span>)
								</small>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid py-5">
		<h2
			class="section-title position-relative text-uppercase mx-xl-5 mb-4">
			<span class="bg-secondary pr-3">Other products</span>
		</h2>
		<div class="row px-xl-5">
			<div class="col">
				<div class="owl-carousel related-carousel">
					<div class="product-item bg-light"
						th:each="item : ${list_proother}">
						<div class="product-img position-relative overflow-hidden">
							<img class="img-fluid w-100" th:src="'/uploads/' + ${item.Img}"
								alt="">
							<div class="product-action">
								<a class="btn btn-outline-dark btn-square"
									th:if="${item.status != 'OutOfStock'}"
									th:onclick="'addToCart(' + ${item.Id} + ')'"> <i
									class="fa fa-shopping-cart"></i>
								</a> <span th:if="${item.Status == 'OutOfStock'}"
									class="out-of-stock-message">Out of stock</span>
							</div>
						</div>
						<div class="text-center py-4">
							<a class="h6 text-decoration-none text-truncate"
								th:href="@{'/detailproduct/product?id=' + ${item.Id}}"
								th:text="${item.Product_name}"></a>
							<div
								class="d-flex align-items-center justify-content-center mt-2">
								<h5 th:text="'$' + ${item.Price}"></h5>
							</div>
							<div
								class="d-flex align-items-center justify-content-center mb-1">
								<div class="text-primary mr-2">
									<th:block th:with="rating=${item.averageRating}">
										<!-- Rating từ 1-5 -->
										<th:block th:if="${rating >= 1}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 0.5 && rating < 1}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 0.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 2}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 1.5 && rating < 2}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 1.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 3}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 2.5 && rating < 3}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 2.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 4}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 3.5 && rating < 4}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 3.5}">
											<small class="far fa-star"></small>
										</th:block>

										<th:block th:if="${rating >= 5}">
											<small class="fas fa-star"></small>
										</th:block>
										<th:block th:if="${rating >= 4.5 && rating < 5}">
											<small class="fas fa-star-half-alt"></small>
										</th:block>
										<th:block th:if="${rating < 4.5}">
											<small class="far fa-star"></small>
										</th:block>
									</th:block>
								</div>
								<small class="pt-1"> (<span
									th:text="${item.totalFeedbacks}">0</span>)
								</small>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer Start -->
	<div th:replace="~{customer/layout/footer_customer}"></div>
	<!-- Footer End -->
	<div id="cartNotification" class="notification">
		<p>The product has been added to the cart successfully!</p>
	</div>

</body>
<script>
function showNotification() {
	const notification = document.getElementById('cartNotification');
	// Đặt display thành none để ẩn thông báo
    notification.style.display = 'none';
    
    // Đợi một chút trước khi hiển thị lại thông báo
    setTimeout(() => {
        notification.style.display = 'block'; // Thiết lập display thành block
        notification.classList.add('show'); // Thêm class show để hiển thị animation
    }, 10); // Thời gian chờ rất ngắn (10ms) để trình duyệt nhận thấy sự thay đổi
    
   
}
function updateQuantity() {
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
		currentQuantity++;
        quantityInput.val(currentQuantity);
   
}
function minusFromCart() {
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
	if (currentQuantity > 1) {
		 currentQuantity--; 
	        quantityInput.val(currentQuantity);
    } 
   
}
function addtocarttttt(proid){
	const quantityInput = $(`#quantitytocart`);
	var currentQuantity = parseInt(quantityInput.val());
	$.ajax({
        url: '/cart/addtocartwq', // Đường dẫn đến endpoint
        type: 'POST', 
        data: { id: proid,
        		quantity : currentQuantity}, 
        success: function(response) {
        	const jsonResponse = JSON.parse(response); 
            if (jsonResponse.status === "false") {
                window.location.href = '/account/signin'; 
            } else if (jsonResponse.status === "success") {
            	showNotification()
            	resetsize()
            	quantityInput.val(1);
            } else if (jsonResponse.status === "failed") {
                alert("Failed to add product to cart.");
            }
           
            
        },
        error: function(xhr, status, error) {
            alert("Đã xảy ra lỗi: " + error);
        }
    });
}
function addToCart(productId) {
    $.ajax({
        url: '/cart/addtocart',
        type: 'POST',
        data: {
            id: productId
        },
        success: function(response) {
           
            try {
                const jsonResponse = JSON.parse(response); 
                if (jsonResponse.status === "false") {
                    window.location.href = '/account/signin'; 
                } else if (jsonResponse.status === "success") {
                	showNotification()
 					resetsize()
                } else if (jsonResponse.status === "failed") {
                    alert("Failed to add product to cart.");
                }
            } catch (e) {
                console.error("An error occurred while processing the response: ", e);
                alert("An error occurred while adding product to cart.");
            }
        },
        error: function(xhr) {
            console.error("Error status: " + xhr.status); // In trạng thái lỗi
            console.error("Error response: " + xhr.responseText); // In nội dung phản hồi
            alert("An error occurred while adding product to cart.");
        }
    });
}
function resetsize() {
    $.ajax({
        url: '/cart/size',
        type: 'POST',
        success: function(response) {
           
            try {
                const jsonResponse = JSON.parse(response);
                const numberquantitycart = document.getElementById('numberquantitycart');
                numberquantitycart.innerHTML=jsonResponse.status
               
            } catch (e) {
            }
        },
        error: function(xhr) {
        }
    });
}
//Toggle hiển thị replies
function toggleReplies(commentId) {
    const repliesDiv = document.getElementById('replies-' + commentId);
    const button = event.currentTarget;
    const icon = button.querySelector('i');
    
    if (repliesDiv.style.display === 'none') {
        repliesDiv.style.display = 'block';
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
    } else {
        repliesDiv.style.display = 'none';
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
    }
}

// Hiển thị form reply
function showReplyInput(commentId) {
    // Ẩn tất cả các reply input khác
    const allReplyInputs = document.querySelectorAll('.reply-input-group');
    allReplyInputs.forEach(input => {
        if (input.id !== 'reply-input-' + commentId) {
            input.style.display = 'none';
        }
    });
    
    // Hiển thị reply input được chọn
    const replyInput = document.getElementById('reply-input-' + commentId);
    if (replyInput) {
        replyInput.style.display = replyInput.style.display === 'flex' ? 'none' : 'flex';
        if (replyInput.style.display === 'flex') {
            replyInput.querySelector('input').focus();
        }
    }
}


let canComment = true;

function submitComment(button, productId) {
    const input = button.previousElementSibling;
    const content = input.value.trim();
    
    if (!content || !canComment) return;

    canComment = false;
    setTimeout(() => { canComment = true; }, 3000);

    const commentData = {
        content: content,
        productId: productId
    };

    $.ajax({
        type: "POST",
        url: "/comment/add",
        data: JSON.stringify(commentData),
        contentType: "application/json",
        success: function(response) {
            input.value = '';
            input.classList.remove('banned');

            const newComment = `
                <div class="comment-item">
                    <div class="comment-main">
                        <div class="comment-header">
                            <div class="user-info">
                                <i class="fas fa-user-circle"></i>
                                <span class="username">${response.customerName}</span>
                            </div>
                            <span class="comment-date">${response.createdAt}</span>
                        </div>
                        
                        <div class="comment-content">${response.content}</div>
                        
                        <div class="comment-actions">
                            <button class="action-btn reply-btn" onclick="showReplyInput(${response.commentId})">
                                <i class="fas fa-reply"></i> Reply
                            </button>
                        </div>

                        <div class="reply-input-group" id="reply-input-${response.commentId}" style="display: none;">
                            <input type="text" class="reply-input" placeholder="Write your reply...">
                            <button class="reply-submit" onclick="submitReply(${response.commentId}, this, ${productId})">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>

                    <div id="replies-${response.commentId}" class="replies-section" style="display: none;">
                    </div>
                </div>
            `;

            $('.comments-container').prepend(newComment);

            const countElement = $('.reviews-count h5 span');
            const currentCount = parseInt(countElement.text());
            countElement.text(currentCount + 1);
        },
        error: function(xhr) {
            if (xhr.status === 401) {
                window.location.href = "/account/signin";
            } else if (xhr.status === 400) {
                input.classList.add('banned');
            }
        }
    });
}

function submitReply(parentId, button, productId) {
    const input = button.previousElementSibling;
    const content = input.value.trim();
    
    if (!content || !canComment) return;

    canComment = false;
    setTimeout(() => { canComment = true; }, 3000);

    const replyData = {
        content: content,
        productId: productId,
        parentId: parentId
    };

    $.ajax({
        type: "POST",
        url: "/comment/reply",
        data: JSON.stringify(replyData),
        contentType: "application/json",
        success: function(response) {
            input.value = '';
            input.classList.remove('banned');

            const newReply = `
                <div class="reply-item">
                    <div class="reply-header">
                        <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span class="username">${response.customerName}</span>
                        </div>
                        <span class="reply-date">${response.createdAt}</span>
                    </div>
                    <div class="reply-content">${response.content}</div>
                </div>
            `;

            // Thêm reply mới vào cuối danh sách replies
            $(`#replies-${parentId}`).append(newReply);
            
            // Hiển thị section replies nếu đang ẩn
            $(`#replies-${parentId}`).show();
        },
        error: function(xhr) {
            if (xhr.status === 401) {
                window.location.href = "/account/signin";
            } else if (xhr.status === 400) {
                input.classList.add('banned');
            }
        }
    });
}

// Reset màu text khi user bắt đầu sửa nội dung
document.querySelectorAll('.comment-input, .reply-input').forEach(input => {
    input.addEventListener('input', function() {
        this.classList.remove('banned');
    });
});


// Hiển thị thông báo
function showNotification(type, message) {
    const notificationClass = type === 'success' ? 'alert-success' : 'alert-danger';
    const notification = `
        <div class="alert ${notificationClass} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    `;
    
    $('#notification-container').html(notification);
    setTimeout(() => {
        $('.alert').alert('close');
    }, 3000);
}

// Event listeners khi trang load
document.addEventListener('DOMContentLoaded', function() {
    // Enter để submit main comment
    const mainCommentInput = document.querySelector('.comment-input');
    if (mainCommentInput) {
        mainCommentInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const submitButton = this.nextElementSibling;
                submitButton.click();
            }
        });
    }

    // Enter để submit replies
    document.querySelectorAll('.reply-input').forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const submitButton = this.nextElementSibling;
                submitButton.click();
            }
        });
    });
});
function updateMainImage(src) {
    document.getElementById('mainProductImage').src = src;
}
</script>
</html>